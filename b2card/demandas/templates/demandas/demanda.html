<meta charset="utf-8">
{% extends "base_page.html" %}

{% block script %}
	<script src="/static/js/apps/demandas/demandas.js"></script>
	<script src="/static/js/apps/demandas/demandas-services.js"></script>
	<script src="/static/js/apps/cadastros/centrocusto/centrocusto-services.js"></script>
	<script src="/static/js/apps/cadastros/valorhora/valorhora-services.js"></script>
	<script src="/static/js/commons/commons.js"></script>
	<script src="/static/js/angular/ui-bootstrap-tpls-2.2.0.min.js"></script>
	<script src="/static/js/jquery/priceformat/jquery.priceformat.min.js"></script>
{% endblock %}

{%block content%}

{% if demanda %}
<script type="text/javascript">
	var demanda_id = {{demanda.id}}
	var cliente_id = {{demanda.cliente.id}}
</script>
{% else %}
<script type="text/javascript">
	var demanda_id = null;
	var cliente_id = null;
</script>
{% endif %}

{%verbatim%}

<style>
	span.red { 
   		color:red;
  	}
  	button.margin {
		margin-bottom: 1em;
		margin-top: 1em;
	}
	
	span.margin {
		margin: -3px;
	}
	
	table thead tr th{
		text-align: center;
	}
	
	.heading-text-align {
		text-align: center;
	}
	
	.margin-top {
		margin-top: 2em;
	}
	
</style>

<h1>Demanda</h1>
<div ng-app="demandas" ng-controller="DemandaController as $ctrl" class="ng-hide" ng-show="$ctrl.show">
	<form name="demanda">
		
		<button type="button" class="btn btn-primary margin" ng-click="$ctrl.salvardemanda()" ng-disabled="demanda.$invalid || itensfaturamento.$invalid">Salvar</button>
		<button type="submit" class="btn btn-danger margin" name="deletar" ng-click="$ctrl.deletar()" ng-show="$ctrl.demanda.id">Deletar</button>
		<div class="label {{$ctrl.clazz}}" ng-bind="$ctrl.message" ></div>
			
		<div class="panel panel-primary form-group-sm">
			<div class="panel-heading"><strong>Dados da demanda</strong></div>
			<div class="panel-body">
				<div class="row">
					<div class="col-md-3">
						<div class="form-group">
							<label for="titulo">Título da demanda</label> 
						    <input type="text" id="titulo" name="titulo" ng-model="$ctrl.demanda.titulo" class="form-control" required maxlength="30"/>
						    <span class="red" ng-show="demanda.titulo.$invalid">Título da demanda é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="cliente">Cliente</label> 
						    <select id="cliente" name="cliente" class="form-control" ng-change="$ctrl.changecliente()" ng-model="$ctrl.demanda.cliente.id" ng-options="c.id as c.razao_social for c in $ctrl.listaclientes" required>
						    	<option value="">Selecione um cliente...</option>
						    </select>
							<span class="red" ng-show="demanda.cliente.$invalid">Cliente é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="centro_resultado">Centro de resultado</label> 
						    <select id="centro_resultado" name="centro_resultado" class="form-control" ng-model="$ctrl.demanda.centro_resultado.id" ng-options="r.id as r.razao_social for r in $ctrl.listacentroresultado" required>
						    	<option value="">Centro de resultado...</option>
						    </select>
							<span class="red" ng-show="demanda.cliente.$invalid">Cliente é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="identificacao">Identificação</label> 
						    <input type="text" id="identificacao" name="identificacao" ng-model="$ctrl.demanda.identificacao" class="form-control" required maxlength="30"/>
						    <span class="red" ng-show="demanda.identificacao.$invalid">Identificação é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-2">
						<div class="form-group form-group-sm">
							<label for="tipo_demanda">Tipo da demanda</label> 
						    <select id="tipo_demanda" name="tipo_demanda" ng-model="$ctrl.demanda.tipo_demanda" class="form-control" required>
					    		<option value="">Selecione um tipo...</option>
					    		<option value="D">Desenvolvimento</option>
					    		<option value="H">Homologação</option>
					    		<option value="C">Consultoria</option>
					    		<option value="A">Alocação</option>
					    	</select>
					    	<span class="red" ng-show="demanda.tipo_demanda.$invalid">Tipo da demanda é obrigatório.</span>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-2">
						<div class="form-group form-group-sm">
							<label for="status_demanda"> Status da demanda</label> 
						    <select id="status_demanda" name="status_demanda" ng-model="$ctrl.demanda.status_demanda" class="form-control" required>
					    		<option value="">Selecione um tipo...</option>
					    		<option value="O">Em orçamentação</option>
					    		<option value="A">Aguardando aprovação</option>
					    		<option value="N">Não aprovada</option>
					    		<option value="C">Cancelada</option>
					    		<option value="H">Em homologação</option>
					    		<option value="I">Implantada</option>
					    		<option value="D">Em desenvolvimento</option>
					    	</select>
					    	<span class="red" ng-show="demanda.tipo_demanda.$invalid">Status da demanda é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="codigo_cri">Código de CRI</label> 
						    <input type="text" id="codigo_cri" name="codigo_cri" ng-model="$ctrl.demanda.codigo_cri" class="form-control" maxlength="12"/>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="data_aprovacao_demanda">Data de aprovação da demanda</label> 
						    <input type="text" id="data_aprovacao_demanda" name="data_aprovacao_demanda" ng-model="$ctrl.demanda.data_aprovacao_demanda"  ui-mask="99/99/9999" model-view-value="true" class="form-control" maxlength="12"/>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="form-group">
							<label for="descricao">Descrição</label> 
						    <textarea id="descricao" name="descricao" ng-model="$ctrl.demanda.descricao" class="form-control" required></textarea>
						    <span class="red" ng-show="demanda.descricao.$invalid">Descrição é obrigatório.</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	<ul class="nav nav-tabs">
	  <li class="active"><a data-toggle="tab" href="#orcamento">Orçamento</a></li>
	  <li><a data-toggle="tab" href="#itens_faturamento">Itens de faturamento da demanda</a></li>
	  <li><a data-toggle="tab" href="#proposta">Proposta</a></li>
	  <li><a data-toggle="tab" href="#tarefas">Tarefas</a></li>
	  <li><a data-toggle="tab" href="#observacoes">Observações</a></li>
	  <li><a data-toggle="tab" href="#ocorrencias">Ocorrências</a></li>
	</ul>
	<div class="tab-content">
		<div id="orcamento" class="tab-pane in active">
			<form name="orcamento">
				<div class="panel panel-primary margin-top">
					<div class="panel-heading">
						Dados do orçamento
					</div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-6">	
								<div class="form-group form-group-sm">
									<label for="centro_custo">Centro de custo</label> 
						    		<select id="centro_custo" name="centro_custo"  ng-model="$ctrl.demanda.orcamento.centro_custo.id" class="form-control" ng-change="$ctrl.changecentrocusto()" ng-options="c.id as c.nome for c in $ctrl.listacentrocustos" required>
						    			<option value="">Selecione...</option>
						    		</select>
						    		<span class="red" ng-show="orcamento.centro_custo.$invalid">Centro de custo é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<div class="form-group form-group-sm">
									<label for="descricao" >Descrição</label> 
						    		<textarea ng-model="$ctrl.demanda.orcamento.descricao" class="form-control"></textarea>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">	
								<div class="form-group form-group-sm">
									<label for="total_orcamento">Total orçamento</label> 
						    		<input type="text" id="total_orcamento" name="total_orcamento"  ng-model="$ctrl.demanda.orcamento.total_orcamento" class="form-control" required disabled="disabled"/>
								</div>
							</div>
						</div>
					</div>
				</div>
										
				<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarfase()">
			  		<span class="glyphicon glyphicon-plus"></span> Adicionar fase
				</button>	
				
				<div class="panel panel-primary" ng-repeat="fase in $ctrl.demanda.orcamento.fases" ng-show="!fase.remover">
					<div class="panel-heading">
						<strong>{{fase.descricao ? fase.descricao : '(Sem descrição)'}}</strong>
						<div class="btn-group pull-right">
							<button type="button" class="btn btn-primary" ng-click="$ctrl.remover(fase)">
			  					<span class="glyphicon glyphicon-trash margin"></span>
							</button>
						</div>
					</div>
					<div class="panel-body">	
						<div class="row">						
							<div class="col-sm-6 form-group form-group-sm">
								<label for="fase_descricao">Descrição</label> 
					   			<input type="text" id="fase_descricao" name="fase_descricao"  ng-model="fase.descricao" class="form-control" required/>
							</div>
						</div>
						
						<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionaritemfase(fase)">
				  			<span class="glyphicon glyphicon-plus"></span> Adicionar valor hora
						</button>
						
						<table class="table table-sm table-bordered table-striped table-highlight">
							<thead>
								<tr class="active">
									<th>Valor hora</th>
									<th>Valor</th>
									<th>Quantidade de horas</th>
									<th>Valor final</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="itemfase in fase.itensfase" ng-show="!itemfase.remover">
									<td>
										<select id="valorhora" name="valorhora" ng-model="itemfase.valor_hora.id" ng-change="$ctrl.changevalorhora(itemfase)" class="form-control" ng-options="v.id as v.descricao for v in $ctrl.listavalorhora">
								    		<option value="">Selecione um tipo...</option>
								    	</select>
									</td>
									<td>
										<input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="itemfase.valor_selecionado" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<input type="number" id="comissao_comercial" name="comissao_comercial" ng-model="itemfase.quantidade_horas" ng-change="$ctrl.changefasequantidadehoras(itemfase)" class="form-control"/>
									</td>
									<td>
										<input type="text" id="valor_faturamento" name="valor_faturamento" ng-model="itemfase.valor_total" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<button type="button" class="btn btn-default" ng-click="$ctrl.remover(itemfase)">
											<span class="glyphicon glyphicon-trash"></span>
										</button>
									</td>
								</tr>
							</tbody>
						</table>
						
						<div class="form-group form-group-sm">
							<label for="descricao">Valor total</label> 
						    <input type="text" id="descricao" name="descricao" ng-model="fase.valor_total" class="form-control" disabled/>
						</div>
						
					</div>
				</div>
			</form>
		</div>
  		<div id="itens_faturamento" class="tab-pane">
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionaritem()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar item
			</button>
			
			<form name="itensfaturamento" ng-repeat="item_faturamento in $ctrl.demanda.itens_faturamento" ng-show="!item_faturamento.remover">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<strong>{{item_faturamento.descricao ? item_faturamento.descricao : '(Sem descrição)'}}</strong>
						<div class="btn-group pull-right">
							<button type="button" class="btn btn-primary" ng-click="$ctrl.remover(item_faturamento)">
			  					<span class="glyphicon glyphicon-trash margin"></span>
							</button>
						</div>
					</div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group form-group-sm">
									<label for="descricao">Descrição</label> 
								    <input type="text" id="descricao" name="descricao" ng-model="item_faturamento.descricao" class="form-control" required maxlength="200"/>
								    <span class="red" ng-show="itensfaturamento.descricao.$invalid">Descrição é obrigatório.</span>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group form-group-sm">
									<label for="numero_nota">Numero da nota</label> 
								    <input type="text" id="numero_nota" name="numero_nota" ng-model="item_faturamento.numero_nota" class="form-control" required maxlength="30"/>
								    <span class="red" ng-show="itensfaturamento.numero_nota.$invalid">Numero da nota é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Status</label> 
								     <select id="cargo" name="cargo" ng-model="item_faturamento.status" class="form-control">
							    		<option value="">Selecione um tipo...</option>
							    		<option value="P">Pendente aprovação</option>
							    		<option value="A">Aprovado</option>
							    		<option value="R">Reprovado</option>
							    	</select>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_env_aprov">Data envio aprovação</label> 
								    <input type="text" id="data_env_aprov" name="data_env_aprov" ng-model="item_faturamento.data_envio_aprovacao" ui-mask="99/99/9999" model-view-value="true" ng-change="$ctrl.changedataenvioaprovacao(item_faturamento)"  class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_previsto_faturamento">Data previsto faturamento</label>
								    <input type="text" id="data_previsto_faturamento" name="data_previsto_faturamento" ng-model="item_faturamento.data_previsto_faturamento" ui-mask="99/99/9999" model-view-value="true" ng-change="$ctrl.dataprevistofaturamento(item_faturamento)" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_previsto_pagamento">Data previsto pagamento</label> 
								    <input type="text" id="data_previsto_pagamento" name="data_previsto_pagamento" ng-model="item_faturamento.data_previsto_pagamento" ui-mask="99/99/9999" model-view-value="true" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_fat">Data faturamento</label> 
								    <input type="text" id="data_fat" name="data_fat" ng-model="item_faturamento.data_fatura" ui-mask="99/99/9999" model-view-value="true" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_pagamento">Data pagamento</label> 
								    <input type="text" id="data_pagamento" name="data_pagamento" ng-model="item_faturamento.data_pagamento" ui-mask="99/99/9999" model-view-value="true" class="form-control"/>
								</div>
							</div>
						</div>
						
						<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionartipovalorhora(item_faturamento)">
					  		<span class="glyphicon glyphicon-plus"></span> Adicionar tipo valor hora
						</button>
						
						<table class="table table-sm table-bordered table-striped table-highlight">
							<thead>
								<tr class="active">
									<th>Tipo horas do cliente</th>
									<th>Valor da hora</th>
									<th>Quantidade de horas</th>
									<th>Valor faturamento</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="tipovalorhora in item_faturamento.tipovalorhoras" ng-show="!tipovalorhora.remover">
									<td>
										<select id="cargo" name="cargo" ng-model="tipovalorhora.tipo_hora.id" ng-change="$ctrl.changehoraproposta(tipovalorhora, item_faturamento)" class="form-control" ng-options="t.id as t.tipo_hora for t in $ctrl.listatipovalorhora">
								    		<option value="">Selecione um tipo...</option>
								    	</select>
									</td>
									<td>
										<input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="tipovalorhora.valor_hora" ng-change="$ctrl.changehoraproposta(tipovalorhora, item_faturamento)" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<input type="number" id="comissao_comercial" name="comissao_comercial" ng-model="tipovalorhora.quantidade_horas" ng-change="$ctrl.changehoraproposta(tipovalorhora, item_faturamento)" class="form-control"/>
									</td>
									<td>
										<input type="text" id="valor_faturamento" name="valor_faturamento" ng-model="tipovalorhora.valor_faturamento" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<button type="button" class="btn btn-default" ng-click="$ctrl.remover(tipovalorhora); $ctrl.recalcularfaturamentototal(item_faturamento);">
											<span class="glyphicon glyphicon-trash"></span>
										</button>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="col-sm-4">
							<div class="form-group form-group-sm">
								<label for="valor_total_faturamento">Valor total da fatura</label> 
							    <input type="text" id="valor_total_faturamento" name="valor_total_faturamento" ng-model="item_faturamento.valor_total_faturamento" gb-money class="form-control" disabled/>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		
		<div id="proposta" class="tab-pane">
		   	
		   	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarproposta()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar proposta
			</button>
			
			<form name="proposta" >
				<table class="table table-sm table-bordered table-striped table-highlight">
					<thead>
					  <tr class="active">
					    <th colspan="4">Proposta</th>
					    <th colspan="3">Aprovação</th>
					    <th></th>
					  </tr>
					  <tr class="active">
					    <th>Data recimento solicitação</th>
					    <th>Data limite entrega</th>
					    <th>Data real entrega</th>
					    <th>Númerdo da proposta B2Card</th>
					    <th>Data de aprovação</th>
					    <th>Empresa ganhadora</th>
					    <th>Tot horas ganhadora</th>
					    <th></th>
					  </tr>
					</thead>
					<tbody>
						<tr ng-repeat="proposta in $ctrl.demanda.propostas" ng-show="!proposta.remover">
							<td>
								<input type="text" ng-model="proposta.data_recimento_solicitacao" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_limite_entrega" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_real_entrega" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.numerdo_proposta" class="form-control" maxlength="30" placeholder="Númerdo da proposta B2Card"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_aprovacao" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.empresa_ganhadora" class="form-control" maxlength="30" placeholder="Empresa ganhadora"/>
							</td>
							<td>
								<input type="number" ng-model="proposta.total_horas_ganhadora" class="form-control" placeholder="Tot horas ganhadora"/>
							</td>
							<td>
								<button type="button" class="btn btn-default" ng-click="$ctrl.remover(proposta)">
									<span class="glyphicon glyphicon-trash"></span>
								</button>
							</td>
						</tr>
					</tbody>
				</table>
			</form>
		</div>
		
		<div id="tarefas" class="tab-pane">
		
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionartarefa()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar tarefa
			</button>	
			<form name="tarefaform" ng-repeat="tarefa in $ctrl.demanda.tarefas" ng-show="!tarefa.remover">
				<div class="panel panel-primary form-group-sm">
					<div class="panel-heading">
						<div class="btn-group" ng-show="!tarefa.show">
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(tarefa)">
			  					<span class="glyphicon glyphicon-plus margin"></span>
							</button>
						</div>
						<div class="btn-group"  ng-show="tarefa.show">
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(tarefa)">
			  					<span class="glyphicon glyphicon-minus margin"></span>
							</button>
						</div>
						<strong>{{tarefa.descricao ? tarefa.descricao : '(Sem descrição)'}}</strong>
						<div class="btn-group pull-right">					
							<button type="button" class="btn btn-primary" ng-click="$ctrl.remover(tarefa)">
			  					<span class="glyphicon glyphicon-trash margin"></span>
							</button>
						</div>
					</div>
					<div class="panel-body" ng-show="tarefa.show">
						<div class="row">
							<div class="col-sm-5">
								<div class="form-group">
									<label for="descricao">Descrição</label> 
								    <textarea id="descricao" name="descricao" ng-model="tarefa.descricao" class="form-control" required></textarea>
								    <span class="red" ng-show="tarefaform.descricao.$invalid">Descrição é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-3">
								<div class="form-group">
									<label for="analista_tecnico_responsavel">Analista técnico responsável</label> 
								    <select id=analista_tecnico_responsavel name="analista_tecnico_responsavel" class="form-control" ng-model="tarefa.analista_tecnico_responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um analista...</option>
									</select>
								    <span class="red" ng-show="tarefaform.analista_tecnico_responsavel.$invalid">Analista técnico responsável é obrigatório.</span>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="descricao">Responsável</label> 
								    <select id=responsavel name="responsavel" class="form-control" ng-model="tarefa.responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um analista...</option>
									</select>
								    <span class="red" ng-show="tarefaform.responsavel.$invalid">Responsável é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Análise</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Inicio</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.analise_inicio" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim">Fim</label> 
												    <input type="text" id="analise_fim" name="analise_fim" ng-model="tarefa.analise_fim" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim_real">Fim Real</label> 
												    <input type="text" id="analise_fim_real" name="analise_fim_real" ng-model="tarefa.analise_fim_real" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Desenvolvimento</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Inicio</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.densenvolvimento_inicio" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim">Fim</label> 
												    <input type="text" id="analise_fim" name="analise_fim" ng-model="tarefa.desenvolvimento_fim" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim_real">Fim Real</label> 
												    <input type="text" id="analise_fim_real" name="analise_fim_real" ng-model="tarefa.desenvolvimento_fim_real" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Homologação</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_possui_sit">Possui SIT</label> 
												    <select id="homologacao_possui_sit" ng-model="tarefa.homologacao_possui_sit" class="form-control">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_inicio">Inicio</label> 
												    <input type="text" id="homologacao_inicio" name="homologacao_inicio" ng-model="tarefa.homologacao_inicio" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_fim">Fim</label> 
												    <input type="text" id="homologacao_fim" name="homologacao_fim" ng-model="tarefa.homologacao_fim" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_fim_real">Fim Real</label> 
												    <input type="text" id="homologacao_fim_real" name="homologacao_fim_real" ng-model="tarefa.homologacao_fim_real" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Entrega da Demanda</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Forecast</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.forecast" class="form-control" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Aceite</label> 
													<select class="form-control" ng-model="tarefa.aceite">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>																		
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Evidências</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.evidencias" class="form-control" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Implantação em produção</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.implantacao_producao" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Implantação in logo?</label> 
												    											
													<select class="form-control" ng-model="tarefa.implantacao_in_loco">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>																		
												
												</div>											
											</div>
											
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	
		<div id="observacoes" class="tab-pane">
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarobservacao()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar observação
			</button>
			
			<table class="table table-sm table-bordered table-striped table-highlight">
				<thead>
				  <tr class="active">
				    <th class="col-sm-2">Data da observação</th>
				    <th class="col-sm-12">Observação</th>
				    <th></th>
				  </tr>
				</thead>
				<tbody>
					<tr ng-repeat="observacao in $ctrl.demanda.observacoes" ng-show="!observacao.remover">
						<td class="col-sm-2">
							<input type="text" ng-model="observacao.data_observacao" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
						</td>
						<td class="col-sm-12">
							<textarea ng-model="observacao.observacao" class="form-control" placeholder="Observação"></textarea>
						</td>
						<td>
							<button type="button" class="btn btn-default" ng-click="$ctrl.remover(observacao)">
								<span class="glyphicon glyphicon-trash"></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="ocorrencias" class="tab-pane">
		
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarocorrencia()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar ocorrência
			</button>
			
			<form name="ocorrenciasform" ng-repeat="ocorrencia in $ctrl.demanda.ocorrencias" ng-show="!ocorrencia.remover">
				<div class="panel panel-primary form-group-sm">
					<div class="panel-heading">
						<div class="btn-group" ng-show="!ocorrencia.show">					
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(ocorrencia)" >
			  					<span class="glyphicon glyphicon-plus margin"></span>
							</button>
						</div>
						<div class="btn-group" ng-show="ocorrencia.show">
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(ocorrencia)" >
			  					<span class="glyphicon glyphicon-minus margin"></span>
							</button>
						</div>
						<strong>{{ocorrencia.descricao ? ocorrencia.descricao : '(Sem descrição)'}}</strong>
						<div class="btn-group pull-right">					
							<button type="button" class="btn btn-primary" ng-click="$ctrl.remover(ocorrencia)">
			  					<span class="glyphicon glyphicon-trash margin"></span>
							</button>
						</div>
					</div>
					<div class="panel-body" ng-show="ocorrencia.show">
						<div class="row">
							<div class="col-sm-3">
								<div class="form-group">
									<label for="tipo_ocorrencia">Tipo de ocorrência</label> 
								    <select class="form-control" id="tipo_ocorrencia" name="tipo_ocorrencia" ng-model="ocorrencia.tipo_ocorrencia" required>
								    	<option value="">Selecione...</option>
								    	<option value="E">Erro</option>
								    	<option value="S">Erro de Especificação</option>
								    	<option value="F">Fora do escopo inicial do projeto</option>
									</select>
									<span class="red" ng-show="ocorrenciasform.tipo_ocorrencia.$invalid">Tipo de ocorrência é obrigatório.</span>											
								</div>
							</div>
							<div class="col-sm-7">
								<div class="form-group">
									<label for="descricao">Descricao</label> 
								    <input type="text" class="form-control" id="descricao" name="descricao" ng-model="ocorrencia.descricao" maxlength="100"/>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-3">
								<div class="form-group">
									<label for="nome_solicitante">Nome do solicitante</label> 
								    <input type="text" class="form-control" id="nome_solicitante" name="nome_solicitante" ng-model="ocorrencia.nome_solicitante" maxlength="30"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="data_solicitacao">Data de solicitação</label> 
								    <input type="text" class="form-control" id="data_solicitacao" name="data_solicitacao" ng-model="ocorrencia.data_solicitacao" ui-mask="99/99/9999" model-view-value="true"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="data_prevista_conclusao">Data prevista conclusão</label> 
								    <input type="text" class="form-control" id="data_prevista_conclusao" name="data_prevista_conclusao" ng-model="ocorrencia.data_prevista_conclusao" ui-mask="99/99/9999" model-view-value="true"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="etapa">Etapa</label> 
								    <select class="form-control" id="etapa" name="etapa" ng-model="ocorrencia.etapa">
								    	<option value="">Selecione...</option>
								    	<option value="C">Concluído</option>
								    	<option value="A">Aguardando análise</option>
								    	<option value="E">Em avaliação</option>
									</select>											
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="responsavel">Responsável B2Card</label> 
								    <select id=responsavel name="responsavel" class="form-control" ng-model="ocorrencia.responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um responsável...</option>
									</select>
								</div>
							</div>
							</div>
							<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<label for="descricao_motivo">Descrição do motivo que causaram a ocorrência</label> 
								    <textarea class="form-control" id="descricao_motivo" name="descricao_motivo" ng-model="ocorrencia.descricao_motivo"></textarea>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label for="observacao">Observação</label> 
								    <textarea class="form-control" id="observacao" name="observacao" ng-model="ocorrencia.observacao"></textarea>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
	
	
	
	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.salvardemanda()" ng-disabled="demanda.$invalid || itensfaturamento.$invalid">Salvar</button>
	<button type="submit" class="btn btn-danger margin" name="deletar" ng-click="$ctrl.deletar()" ng-show="$ctrl.demanda.id">Deletar</button>
	<div class="label {{$ctrl.clazz}}" ng-bind="$ctrl.message" ></div>
	
</div>

{%endverbatim%}

{%endblock%}