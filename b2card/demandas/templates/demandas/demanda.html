<meta charset="utf-8">
{% extends "base_page.html" %}

{% block script %}
	<script src="/static/js/apps/demandas/demandas.js"></script>
	<script src="/static/js/apps/demandas/demandas-services.js"></script>
	<script src="/static/js/commons/commons.js"></script>
	<script src="/static/js/angular/ui-bootstrap-tpls-2.2.0.min.js"></script>
	<script src="/static/js/jquery/priceformat/jquery.priceformat.min.js"></script>
{% endblock %}

{%block content%}

{% if demanda %}
<script type="text/javascript">
	var demanda_id = {{demanda.id}}
	var cliente_id = {{demanda.cliente.id}}
</script>
{% else %}
<script type="text/javascript">
	var demanda_id = null;
	var cliente_id = null;
</script>
{% endif %}

{%verbatim%}

<style>
	span.red { 
   		color:red;
  	}
  	button.margin {
		margin-bottom: 1em;
		margin-top: 1em;
	}
	table thead tr th{
		text-align: center;
	}
	
	.heading-text-align {
		text-align: center;
	}
</style>

<h1>Demanda</h1>
<div ng-app="demandas" ng-controller="DemandaController as $ctrl" class="ng-hide" ng-show="$ctrl.show">
	<form name="demanda">
		
		<button type="button" class="btn btn-primary margin" ng-click="$ctrl.salvardemanda()" ng-disabled="demanda.$invalid || itensfaturamento.$invalid">Salvar</button>
		<button type="submit" class="btn btn-danger margin" name="deletar" ng-click="$ctrl.deletar()" ng-show="$ctrl.demanda.id">Deletar</button>
		<div class="label {{$ctrl.clazz}}" ng-bind="$ctrl.message" ></div>
			
		<div class="panel panel-default form-group-sm">
			<div class="panel-heading"><strong>Dados da demanda</strong></div>
			<div class="panel-body">
				<div class="row">
					<div class="col-md-3">
						<div class="form-group">
							<label for="cliente">Título da demanda</label> 
						    <input type="text" id="titulo" name="titulo" ng-model="$ctrl.demanda.titulo" class="form-control" required maxlength="30"/>
						    <span class="red" ng-show="demanda.titulo.$invalid">Título da demanda é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="cliente">Cliente</label> 
						    <select id="cliente" name="cliente" class="form-control" ng-change="$ctrl.changecliente()" ng-model="$ctrl.demanda.cliente.id" ng-options="c.id as c.razao_social for c in $ctrl.listaclientes" required>
						    	<option value="">Selecione um cliente...</option>
						    </select>
							<span class="red" ng-show="demanda.cliente.$invalid">Cliente é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="identificacao">Identificação</label> 
						    <input type="text" id="identificacao" name="identificacao" ng-model="$ctrl.demanda.identificacao" class="form-control" required maxlength="30"/>
						    <span class="red" ng-show="demanda.identificacao.$invalid">Identificação é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-2">
						<div class="form-group form-group-sm">
							<label for="comissao_comercial">Tipo da demanda</label> 
						    <select id="tipo_demanda" name="tipo_demanda" ng-model="$ctrl.demanda.tipo_demanda" class="form-control" required>
					    		<option value="">Selecione um tipo...</option>
					    		<option value="D">Desenvolvimento</option>
					    		<option value="H">Homologação</option>
					    		<option value="C">Consultoria</option>
					    		<option value="A">Alocação</option>
					    	</select>
					    	<span class="red" ng-show="demanda.tipo_demanda.$invalid">Tipo da demanda é obrigatório.</span>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-2">
						<div class="form-group form-group-sm">
							<label for="comissao_comercial"> Status da demanda</label> 
						    <select id="status_demanda" name="status_demanda" ng-model="$ctrl.demanda.status_demanda" class="form-control" required>
					    		<option value="">Selecione um tipo...</option>
					    		<option value="O">Em orçamentação</option>
					    		<option value="A">Aguardando aprovação</option>
					    		<option value="N">Não aprovada</option>
					    		<option value="C">Cancelada</option>
					    		<option value="H">Em homologação</option>
					    		<option value="I">Implantada</option>
					    		<option value="D">Em desenvolvimento</option>
					    	</select>
					    	<span class="red" ng-show="demanda.tipo_demanda.$invalid">Status da demanda é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="identificacao">Código de CRI</label> 
						    <input type="text" id="codigo_cri" name="codigo_cri" ng-model="$ctrl.demanda.codigo_cri" class="form-control" maxlength="12"/>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="form-group">
							<label for="descricao">Descrição</label> 
						    <textarea id="descricao" name="descricao" ng-model="$ctrl.demanda.descricao" class="form-control" required></textarea>
						    <span class="red" ng-show="demanda.descricao.$invalid">Descrição é obrigatório.</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	<ul class="nav nav-tabs">
	  <li class="active"><a data-toggle="tab" href="#itens_faturamento">Itens de faturamento da demanda</a></li>
	  <li><a data-toggle="tab" href="#proposta">Proposta</a></li>
	  <li><a data-toggle="tab" href="#tarefas">Tarefas</a></li>
	  <li><a data-toggle="tab" href="#observacoes">Observações</a></li>
	</ul>
	<div class="tab-content">
  		<div id="itens_faturamento" class="tab-pane fade in active">
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionaritem()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar item
			</button>
			
			<form name="itensfaturamento" ng-repeat="item_faturamento in $ctrl.demanda.itens_faturamento">
				<div class="panel panel-default">
					<div class="panel-heading"><strong>{{item_faturamento.descricao ? item_faturamento.descricao : '(Sem descrição)'}}</strong></div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-12">
								<div class="form-group form-group-sm">
									<label for="descricao">Descrição</label> 
								    <input type="text" id="descricao" name="descricao" ng-model="item_faturamento.descricao" class="form-control" required maxlength="30"/>
								    <span class="red" ng-show="itensfaturamento.descricao.$invalid">Descrição é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Data</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.data" gb-data class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Tipo horas do cliente</label> 
								    <select id="cargo" name="cargo" ng-model="item_faturamento.tipo_hora.id" ng-change="$ctrl.changehoraproposta(item_faturamento)" class="form-control" ng-options="t.id as t.tipo_hora for t in $ctrl.listatipovalorhora">
							    		<option value="">Selecione um tipo...</option>
							    	</select>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Valor da hora</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.valor_hora" ng-change="$ctrl.changehoraproposta(item_faturamento)" maxlength="30" gb-money class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Quantidade horas</label> 
								    <input type="number" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.quantidade_horas" ng-change="$ctrl.changehoraproposta(item_faturamento)" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="valor_faturamento">Valor faturamento</label> 
								    <input type="text" id="valor_faturamento" name="valor_faturamento" ng-model="item_faturamento.valor_faturamento" maxlength="30" gb-money class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Status</label> 
								     <select id="cargo" name="cargo" ng-model="item_faturamento.status" class="form-control">
							    		<option value="">Selecione um tipo...</option>
							    		<option value="P">Pendente aprovação</option>
							    		<option value="A">Aprovado</option>
							    		<option value="R">Reprovado</option>
							    	</select>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_env_aprov">Data env. aprv.</label> 
								    <input type="text" id="data_env_aprov" name="data_env_aprov" ng-model="item_faturamento.data_envio_aprovacao" gb-data class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_aprv_fat">Data aprv. fat.</label> 
								    <input type="text" id="data_aprv_fat" name="data_aprv_fat" ng-model="item_faturamento.data_aprovacao_fatura" gb-data class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_fat">Data fat.</label> 
								    <input type="text" id="data_fat" name="data_fat" ng-model="item_faturamento.data_fatura" gb-data class="form-control"/>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		
		<div id="proposta" class="tab-pane fade">
		   	
		   	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarproposta()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar proposta
			</button>
			
			<form name="proposta" >
				<table class="table table-sm table-bordered table-striped table-highlight">
					<thead>
					  <tr class="active">
					    <th colspan="4">Proposta</th>
					    <th colspan="3">Aprovação</th>
					  </tr>
					  <tr class="active">
					    <th>Data recimento solicitação</th>
					    <th>Data limite entrega</th>
					    <th>Data real entrega</th>
					    <th>Númerdo da proposta B2Card</th>
					    <th>Data de aprovação</th>
					    <th>Empresa ganhadora</th>
					    <th>Tot horas ganhadora</th>
					  </tr>
					</thead>
					<tbody>
						<tr ng-repeat="proposta in $ctrl.demanda.propostas">
							<td>
								<input type="text" ng-model="proposta.data_recimento_solicitacao" class="form-control" gb-data placeholder="Data recimento solicitação"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_limite_entrega" class="form-control" gb-data placeholder="Data limite entrega"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_real_entrega" class="form-control" gb-data placeholder="Data real entrega"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.numerdo_proposta" class="form-control" maxlength="30" placeholder="Númerdo da proposta B2Card"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_aprovacao" class="form-control" gb-data placeholder="Data de aprovação"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.empresa_ganhadora" class="form-control" maxlength="30" placeholder="Empresa ganhadora"/>
							</td>
							<td>
								<input type="number" ng-model="proposta.total_horas_ganhadora" class="form-control" placeholder="Tot horas ganhadora"/>
							</td>
						</tr>
					</tbody>
				</table>
			</form>
		</div>
		
		<div id="tarefas" class="tab-pane fade">
		
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionartarefa()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar tarefa
			</button>	
			<form name="tarefaform" ng-repeat="tarefa in $ctrl.demanda.tarefas">
				<div class="panel panel-primary form-group-sm">
					<div class="panel-heading"><strong>Dados da tarefa</strong></div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-5">
								<div class="form-group">
									<label for="descricao">Descrição</label> 
								    <textarea id="descricao" name="descricao" ng-model="tarefa.descricao" class="form-control" required></textarea>
								    <span class="red" ng-show="tarefaform.descricao.$invalid">Descrição é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-3">
								<div class="form-group">
									<label for="analista_tecnico_responsavel">Analista técnico responsável</label> 
								    <select id=analista_tecnico_responsavel name="analista_tecnico_responsavel" class="form-control" ng-model="tarefa.analista_tecnico_responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um analista...</option>
									</select>
								    <span class="red" ng-show="tarefaform.analista_tecnico_responsavel.$invalid">Analista técnico responsável é obrigatório.</span>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="descricao">Responsável</label> 
								    <select id=responsavel name="responsavel" class="form-control" ng-model="tarefa.responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um analista...</option>
									</select>
								    <span class="red" ng-show="tarefaform.responsavel.$invalid">Responsável é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Análise</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Inicio</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.analise_inicio" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim">Fim</label> 
												    <input type="text" id="analise_fim" name="analise_fim" ng-model="tarefa.analise_fim" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim_real">Fim Real</label> 
												    <input type="text" id="analise_fim_real" name="analise_fim_real" ng-model="tarefa.analise_fim_real" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Desenvolvimento</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Inicio</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.densenvolvimento_inicio" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim">Fim</label> 
												    <input type="text" id="analise_fim" name="analise_fim" ng-model="tarefa.desenvolvimento_fim" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim_real">Fim Real</label> 
												    <input type="text" id="analise_fim_real" name="analise_fim_real" ng-model="tarefa.desenvolvimento_fim_real" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Homologação</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_possui_sit">Possui SIT</label> 
												    <select id="homologacao_possui_sit" ng-model="tarefa.homologacao_possui_sit" class="form-control">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_inicio">Inicio</label> 
												    <input type="text" id="homologacao_inicio" name="homologacao_inicio" ng-model="tarefa.homologacao_inicio" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_fim">Fim</label> 
												    <input type="text" id="homologacao_fim" name="homologacao_fim" ng-model="tarefa.homologacao_fim" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_fim_real">Fim Real</label> 
												    <input type="text" id="homologacao_fim_real" name="homologacao_fim_real" ng-model="tarefa.homologacao_fim_real" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Entrega da Demanda</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Forecast</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.forecast" class="form-control" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Aceite</label> 
													<select class="form-control" ng-model="tarefa.aceite">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>																		
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Evidências</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.evidencias" class="form-control" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Implantação em produção</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.implantacao_producao" class="form-control" gb-data maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Implantação in logo?</label> 
												    											
													<select class="form-control" ng-model="tarefa.implantacao_in_loco">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>																		
												
												</div>											
											</div>
											
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	
		<div id="observacoes" class="tab-pane fade">
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarobservacao()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar observação
			</button>
			
			<table class="table table-sm table-bordered table-striped table-highlight">
				<thead>
				  <tr class="active">
				    <th class="col-sm-2">Data da observação</th>
				    <th class="col-sm-12">Observação</th>
				  </tr>
				</thead>
				<tbody>
					<tr ng-repeat="observacao in $ctrl.demanda.observacoes">
						<td class="col-sm-2">
							<input type="text" ng-model="observacao.data_observacao" class="form-control" gb-data placeholder="Data da observação"/>
						</td>
						<td class="col-sm-12">
							<input type="text" ng-model="observacao.observacao" class="form-control" maxlength="100" placeholder="Observação"/>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.salvardemanda()" ng-disabled="demanda.$invalid || itensfaturamento.$invalid">Salvar</button>
	<button type="submit" class="btn btn-danger margin" name="deletar" ng-click="$ctrl.deletar()" ng-show="$ctrl.demanda.id">Deletar</button>
	<div class="label {{$ctrl.clazz}}" ng-bind="$ctrl.message" ></div>
	
</div>

{%endverbatim%}

{%endblock%}