<meta charset="utf-8">
{% extends "base_page.html" %}

{% block script %}
	<script src="/static/js/apps/demandas/demandas.js"></script>
	<script src="/static/js/apps/demandas/demandas-services.js"></script>
	<script src="/static/js/commons/commons.js"></script>
	<script src="/static/js/angular/ui-bootstrap-tpls-2.2.0.min.js"></script>
	<script src="/static/js/jquery/priceformat/jquery.priceformat.min.js"></script>
{% endblock %}

{%block content%}

{% if demanda %}
<script type="text/javascript">
	var demanda_id = {{demanda.id}}
	var cliente_id = {{demanda.cliente.id}}
</script>
{% else %}
<script type="text/javascript">
	var demanda_id = null;
	var cliente_id = null;
</script>
{% endif %}

{%verbatim%}

<style>
	span.red { 
   		color:red;
  	}
  	button.margin {
		margin-bottom: 1em;
		margin-top: 1em;
	}
</style>

<h1>Demanda</h1>
<div ng-app="demandas" ng-controller="DemandaController as $ctrl" class="ng-hide" ng-show="$ctrl.show">
	<form name="demanda">
		
		<button type="button" class="btn btn-primary margin" ng-click="$ctrl.salvardemanda()" ng-disabled="demanda.$invalid || itensfaturamento.$invalid">Salvar</button>
		<button type="submit" class="btn btn-danger margin" name="deletar" ng-click="$ctrl.deletar()" ng-show="$ctrl.demanda.id">Deletar</button>
		<div class="label {{$ctrl.clazz}}" ng-bind="$ctrl.message" ></div>
			
		<div class="panel panel-default form-group-sm">
			<div class="panel-heading"><strong>Dados da demanda</strong></div>
			<div class="panel-body">
				<div class="row">
					<div class="col-md-3">
						<div class="form-group">
							<label for="cliente">Cliente</label> 
						    <select id="cliente" name="cliente" class="form-control" ng-change="$ctrl.changecliente()" ng-model="$ctrl.demanda.cliente.id" ng-options="c.id as c.razao_social for c in $ctrl.listaclientes" required>
						    	<option value="">Selecione um cliente...</option>
						    </select>
							<span class="red" ng-show="demanda.cliente.$invalid">Cliente é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-2">
						<div class="form-group">
							<label for="data_aprovacao">Data de aprovação</label> 
						    <input type="text" id="data_aprovacao" name="data_aprovacao" ng-model="$ctrl.demanda.data_aprovacao" class="form-control" gb-data required/>
						    <span class="red" ng-show="demanda.data_aprovacao.$invalid">Data é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="identificacao">Identificação</label> 
						    <input type="text" id="identificacao" name="identificacao" ng-model="$ctrl.demanda.identificacao" class="form-control" required/>
						    <span class="red" ng-show="demanda.identificacao.$invalid">Identificação é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<label for="numero_proposta">Númerdo da proposta B2Card</label> 
						    <input type="text" id="numero_proposta" name="numero_proposta" ng-model="$ctrl.demanda.numero_proposta" class="form-control" required/>
						    <span class="red" ng-show="demanda.numero_proposta.$invalid">Número da proposta é obrigatório.</span>
						</div>
					</div>
					<div class="col-md-12">
						<div class="form-group">
							<label for="descricao">Descrição</label> 
						    <textarea id="descricao" name="descricao" ng-model="$ctrl.demanda.descricao" class="form-control" required></textarea>
						    <span class="red" ng-show="demanda.descricao.$invalid">Descrição é obrigatório.</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
		
	<ul class="nav nav-tabs">
	  <li class="active"><a data-toggle="tab" href="#menu1">Itens de faturamento da demanda</a></li>
	  <li><a data-toggle="tab" href="#menu2">Tarefas</a></li>
	</ul>
	<div class="tab-content">
  		<div id="menu1" class="tab-pane fade in active">
	
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionaritem()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar item
			</button>
			
			<form name="itensfaturamento" ng-repeat="item_faturamento in $ctrl.demanda.itens_faturamento">
				<div class="panel panel-default">
					<div class="panel-heading"><strong>{{item_faturamento.descricao ? item_faturamento.descricao : '(Sem descrição)'}}</strong></div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-12">
								<div class="form-group form-group-sm">
									<label for="descricao">Descrição</label> 
								    <input type="text" id="descricao" name="descricao" ng-model="item_faturamento.descricao" class="form-control" required/>
								    <span class="red" ng-show="itensfaturamento.descricao.$invalid">Descrição é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Data</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.data" gb-data class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Tipo horas do cliente</label> 
								    <select id="cargo" name="cargo" ng-model="item_faturamento.tipo_hora" ng-change="$ctrl.changehoraproposta(item_faturamento)" class="form-control" ng-options="t as t.tipo_hora for t in $ctrl.listatipovalorhora">
							    		<option value="">Selecione um tipo...</option>
							    	</select>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Valor da hora</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.valor_hora" ng-change="$ctrl.changehoraproposta(item_faturamento)" gb-money class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Quantidade horas</label> 
								    <input type="number" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.quantidade_horas" ng-change="$ctrl.changehoraproposta(item_faturamento)" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Valor faturamento</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.valor_faturamento" gb-money class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Status</label> 
								     <select id="cargo" name="cargo" ng-model="item_faturamento.status" class="form-control">
							    		<option value="">Selecione um tipo...</option>
							    		<option value="P">Pendente aprovação</option>
							    		<option value="A">Aprovado</option>
							    		<option value="R">Reprovado</option>
							    	</select>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Data env. aprv.</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.data_envio_aprovacao" gb-data class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Data aprv. fat.</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.data_aprovacao_fatura" gb-data class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Data fat.</label> 
								    <input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="item_faturamento.data_fatura" gb-data class="form-control"/>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
			
		</div>
		<div id="menu2" class="tab-pane fade">
		   	
		   	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionaritem()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar tarefa
			</button>
			
			<form name="itensfaturamento" ng-repeat="item_faturamento in $ctrl.demanda.itens_faturamento">
				
			</form>
		</div>
	</div>
	
</div>

{%endverbatim%}

{%endblock%}