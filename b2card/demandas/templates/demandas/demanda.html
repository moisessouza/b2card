<meta charset="utf-8">
{% extends "base_page.html" %}

{% block script %}
	<script src="/static/js/apps/demandas/demandas.js"></script>
	<script src="/static/js/apps/demandas/demandas-services.js"></script>
	<script src="/static/js/apps/faturamento/parcela.js"></script>
	<script src="/static/js/apps/faturamento/parcela-services.js"></script>
	<script src="/static/js/apps/cadastros/centrocusto/centrocusto-services.js"></script>
	<script src="/static/js/apps/cadastros/centroresultado/centroresultado-services.js"></script>
	<script src="/static/js/apps/cadastros/unidadeadministrativa/unidadeadministrativa-services.js"></script>
	<script src="/static/js/apps/cadastros/valorhora/valorhora-services.js"></script>
	<script src="/static/js/commons/commons.js"></script>
	<script src="/static/js/angular/ui-bootstrap-tpls-2.2.0.min.js"></script>
	<script src="/static/js/jquery/priceformat/jquery.priceformat.min.js"></script>
{% endblock %}

{%block content%}

{% if demanda %}
<script type="text/javascript">
	var demanda_id = {{demanda.id}}
	var cliente_id = {{demanda.cliente.id}}
</script>
{% else %}
<script type="text/javascript">
	var demanda_id = null;
	var cliente_id = null;
</script>
{% endif %}

{%verbatim%}

<style>
	span.red { 
   		color:red;
  	}
  	button.margin {
		margin-bottom: 1em;
		margin-top: 1em;
	}
	
	span.margin {
		margin: -3px;
	}
	
	table thead tr th{
		text-align: center;
	}
	
	.heading-text-align {
		text-align: center;
	}
	
	.margin-top {
		margin-top: 2em;
	}
	
	div.scroll {
		overflow-y: scroll;  
		height:400px;
	}
	
	.app-modal-window .modal-dialog {
	  width: 1200px;
	}
	
</style>
<div ng-app="demandas" ng-controller="DemandaController as $ctrl" class="ng-hide" ng-show="$ctrl.show">
	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.salvardemanda()" ng-disabled="demanda.$invalid">Salvar</button>
	<button type="submit" class="btn btn-danger margin" name="deletar" ng-click="$ctrl.deletar()" ng-show="$ctrl.demanda.id">Deletar</button>
	<div class="label {{$ctrl.clazz}}" ng-bind="$ctrl.message" ></div>
	
	<div class="panel panel-primary form-group-sm margin-top">
		<div class="panel-body">
			<div class="form-horizontal">
				<div class="col-sm-1">
					<div class="form-group">
						<label class="control-label col-sm-1" for="id">ID:</label>
						<div class="col-sm-1">
							<p class="form-control-static">{{$ctrl.demanda.id}}</p>
						</div>
					</div>
				</div>
				<div class="col-sm-4">
					<div class="form-group">
						<label class="control-label col-sm-6" for="id">Nome da demanda:</label>
						<div class="col-sm-6">
							<p class="form-control-static">{{$ctrl.demanda.nome_demanda}}</p>
						</div>
					</div>
				</div>
				<div class="col-sm-4">
					<div class="form-group">
						<label class="control-label col-sm-4" for="id">Código da demanda:</label>
						<div class="col-sm-2">
							<p class="form-control-static">{{$ctrl.demanda.codigo_demanda}}</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<ul class="nav nav-tabs">
	  <li class="active"><a data-toggle="tab" href="#dadosdemanda">Dados da demanda</a></li>
	  <li><a data-toggle="tab" href="#orcamento">Orçamento</a></li>
	  <li><a data-toggle="tab" href="#atividades">Atividades</a></li>
	  <li><a data-toggle="tab" href="#itens_faturamento">Itens de faturamento da demanda</a></li>
	  <li><a data-toggle="tab" href="#proposta">Proposta</a></li>
	  <li><a data-toggle="tab" href="#tarefas">Tarefas</a></li>
	  <li><a data-toggle="tab" href="#observacoes">Observações</a></li>
	  <li><a data-toggle="tab" href="#ocorrencias">Ocorrências</a></li>
	  <li><a data-toggle="tab" href="#contasreceber" ng-show="$ctrl.demanda.parcelas && $ctrl.demanda.parcelas.length > 0">Contas a receber</a></li>
	</ul>
	<div class="tab-content">
		<div id="dadosdemanda" class="tab-pane in active">
			<form name="demanda">
					
				<div class="panel panel-primary form-group-sm margin-top">
					<div class="panel-heading"><strong>Dados da demanda</strong></div>
					<div class="panel-body">
						<div class="row">
							<div class="col-md-1">
								<div class="form-group">
									<label for="cliente">ID</label> 
								    <input type="text" id="id" name="id" ng-model="$ctrl.demanda.id" class="form-control" disabled/>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label for="cliente">Cliente</label> 
								    <select id="cliente" name="cliente" class="form-control" ng-change="$ctrl.changecliente()" ng-model="$ctrl.demanda.cliente.id" ng-options="c.id as c.razao_social for c in $ctrl.listaclientes" required>
								    	<option value="">Selecione um cliente...</option>
								    </select>
									<span class="red" ng-show="demanda.cliente.$invalid">Cliente é obrigatório.</span>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label for="nome_demanda">Nome da demanda</label> 
								    <input type="text" id="nome_demanda" name="nome_demanda" ng-model="$ctrl.demanda.nome_demanda" class="form-control" required maxlength="30"/>
								    <span class="red" ng-show="demanda.nome_demanda.$invalid">Nome da demanda é obrigatório.</span>
								</div>
							</div>
							<div class="col-md-2">
								<div class="form-group form-group-sm">
									<label for="status_demanda"> Status da demanda</label> 
								    <select id="status_demanda" name="status_demanda" ng-model="$ctrl.demanda.status_demanda" class="form-control" required>
							    		<option value="">Selecione um tipo...</option>
							    		<option value="O">Em orçamentação</option>
							    		<option value="A">Aguardando aprovação</option>
							    		<option value="N">Não aprovada</option>
							    		<option value="C">Cancelada</option>
							    		<option value="H">Em homologação</option>
							    		<option value="I">Implantada</option>
							    		<option value="D">Em desenvolvimento</option>
							    	</select>
							    	<span class="red" ng-show="demanda.status_demanda.$invalid">Status da demanda é obrigatório.</span>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label for="codigo_demanda">Código da demanda</label> 
								    <input type="text" id="codigo_demanda" name="codigo_demanda" ng-model="$ctrl.demanda.codigo_demanda" class="form-control" maxlength="12" required/>
								    <span class="red" ng-show="demanda.codigo_demanda.$invalid">Código da demanda é obrigatório.</span>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label for="unidade_administrativa">Unidade administrativa</label> 
								    <select id="unidade_administrativa" name="unidade_administrativa" class="form-control" ng-model="$ctrl.demanda.unidade_administrativa.id" ng-options="u.id as (u.codigo + ' - ' + u.nome) for u in $ctrl.listaunidadeadministrativas" required>
								    	<option value="">Selecione uma unidade...</option>
								    </select>
								    <span class="red" ng-show="demanda.unidade_administrativa.$invalid">Unidade administrativa é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-12">
								<div class="form-group">
									<label for="descricao">Descrição</label> 
								    <textarea id="descricao" name="descricao" ng-model="$ctrl.demanda.descricao" class="form-control"></textarea>
								</div>
							</div>
						</div>
						
					</div>
				</div>
			</form>
		</div>
		<div id="orcamento" class="tab-pane">
			<form name="orcamento">
				<div class="panel panel-primary margin-top">
					<div class="panel-heading">
						Total orçamento
					</div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-6">	
								<div class="form-group form-group-sm">
						    		<input type="text" id="total_orcamento" name="total_orcamento"  ng-model="$ctrl.demanda.orcamento.total_orcamento" class="form-control" disabled="disabled"/>
								</div>
							</div>
							<div class="col-sm-6">	
								<button type="button" class="btn btn-sm btn-primary" ng-click="$ctrl.modalcontasreceber()" ng-show="$ctrl.demanda.orcamento.id && $ctrl.demanda.orcamento.total_orcamento && (!$ctrl.demanda.parcelas || $ctrl.demanda.parcelas.length == 0)">Gerar contas a receber</button>
							</div>
						</div>
					</div>
				</div>
				
				<button type="button" class="btn btn-default margin" ng-click="$ctrl.novafase()">
			  		Nova fase
				</button>			
							
				<div class="panel panel-primary" ng-show="$ctrl.fase">
					<div class="panel-heading">
						<strong>{{$ctrl.fase.descricao ? $ctrl.fase.descricao : '(Sem descrição)'}}</strong>
					</div>
					<div class="panel-body">	
						<div class="row">	
							<div class="col-sm-1 form-group form-group-sm">
								<label for="fase_id">ID</label> 
					   			<input type="text" id="fase_id" name="fase_id"  ng-model="$ctrl.fase.id" class="form-control" disabled/>
							</div>					
							<div class="col-sm-6 form-group form-group-sm">
								<label for="fase_descricao">Descrição</label> 
					   			<input type="text" id="fase_descricao" name="fase_descricao"  ng-model="$ctrl.fase.descricao" class="form-control" required/>
							</div>
						</div>
						
						<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionaritemfase()">
				  			<span class="glyphicon glyphicon-plus"></span> Adicionar valor hora
						</button>
						
						<table class="table table-sm table-bordered table-striped table-highlight">
							<thead>
								<tr class="active">
									<th>Valor hora</th>
									<th>Valor</th>
									<th>Quantidade de horas</th>
									<th>Valor final</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="itemfase in $ctrl.fase.itensfase" ng-show="!itemfase.remover">
									<td>
										<select id="valorhora" name="valorhora" ng-model="itemfase.valor_hora.id" ng-change="$ctrl.changevalorhora(itemfase)" class="form-control" ng-options="v.id as v.descricao for v in $ctrl.listavalorhora">
								    		<option value="">Selecione um tipo...</option>
								    	</select>
									</td>
									<td>
										<input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="itemfase.valor_selecionado" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<input type="number" id="comissao_comercial" name="comissao_comercial" ng-model="itemfase.quantidade_horas" ng-change="$ctrl.changefasequantidadehoras(itemfase)" class="form-control"/>
									</td>
									<td>
										<input type="text" id="valor_faturamento" name="valor_faturamento" ng-model="itemfase.valor_total" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<button type="button" class="btn btn-default" ng-click="$ctrl.remover(itemfase, $ctrl.calcularvalortotalorcamento)">
											<span class="glyphicon glyphicon-trash"></span>
										</button>
									</td>
								</tr>
							</tbody>
						</table>
						
						<div class="form-group form-group-sm">
							<label for="descricao">Valor total</label> 
						    <input type="text" id="descricao" name="descricao" ng-model="$ctrl.fase.valor_total" class="form-control" disabled required/>
						</div>
						
						<button type="button" class="btn btn-default margin" ng-click="$ctrl.salvarfase()" ng-disabled="orcamento.$invalid">
					  		Incluir
						</button>
						<button type="button" class="btn btn-default margin" ng-click="$ctrl.cancelarfase()">
					  		Cancelar
						</button>
						
					</div>
				</div>
				
				<table class="table table-sm table-bordered table-striped table-highlight" style="text-align: center;">
					<thead>
						<tr class="active">
							<th>ID</th>
							<th>Fase</th>
							<th></th>
							<th></th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="fase in $ctrl.demanda.orcamento.fases" ng-show="!fase.remover">
							<td class="col-sm-1">
								<label>{{fase.id}}</label>
							</td>
							<td class="col-sm-2">
								<label>{{fase.descricao}}</label>
							</td>
							<td class="col-sm-8">
								<table class="table table-sm table-bordered table-striped table-highlight">
									<thead>
										<tr>
											<th>Valor hora</th>
											<th>Valor</th>
										</tr>
									</thead>
									<tbody>
										<tr ng-repeat="itemfase in fase.itensfase" ng-show="!itemfase.remover">
											<td>
												{{itemfase.valor_hora.descricao}}</label>
											</td>
											<td>
												{{itemfase.valor_total}}
											</td>
										</tr>
									</tbody>
								</table>
								<div class="form-group">
									<label>Valor final: {{fase.valor_total}}</label>
								</div>
							</td>
							<td>
								<button type="button" class="btn btn-default" ng-click="$ctrl.editarfase(fase)">
									<span class="glyphicon glyphicon-edit"></span>
								</button>
							</td>
							<td>
								<button type="button" class="btn btn-default" ng-click="$ctrl.remover(fase, $ctrl.calcularvalortotalorcamento)">
									<span class="glyphicon glyphicon-trash"></span>
								</button>
							</td>
						</tr>
					</tbody>
				</table>
				
			</form>
		</div>
		<div id="atividades" class="tab-pane">
			<div class="row">
				<div class="col-sm-8">
					<form name="atividade">
						<div class="panel panel-primary margin-top">
							<div class="panel-heading">
								<strong>{{$ctrl.atividade.titulo ? $ctrl.atividade.titulo : '(Sem título)'}}</strong>
							</div>
							<div class="panel-body">
								<div class="row">
									<div class="col-sm-2">
										<div class="form-group form-group-sm">
											<label for="id" >ID</label> 
								    		<input id="id" name="id" type="text" ng-model="$ctrl.atividade.id" maxlength="100" class="form-control" disabled/>
										</div>
									</div>
									<div class="col-sm-8">
										<div class="form-group form-group-sm">
											<label for="titulo" >Título</label> 
								    		<input id="titulo" name="titulo" type="text" ng-model="$ctrl.atividade.titulo" maxlength="100" class="form-control" required/>
								    		<span class="red" ng-show="atividade.titulo.$invalid">Título é obrigatório.</span>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-sm-3">
										<div class="form-group form-group-sm">
											<label for="responsavel">Responsável</label> 
								    		<select id="responsavel" name="responsavel" ng-model="$ctrl.atividade.responsavel.id" class="form-control" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
								    			<option value="">Selecione...</option>
									    	</select>
									    	<span class="red" ng-show="atividade.responsavel.$invalid">Responsável é obrigatório.</span>
										</div>
									</div>
									<div class="col-sm-3">
										<div class="form-group form-group-sm">
											<label for="centro_resultado">Centro de resultado</label> 
								    		<select id="centro_resultado" name="centro_resultado" ng-model="$ctrl.atividade.centro_resultado.id" ng-change="$ctrl.changeatividade()" ng-options="c.id as c.nome for c in $ctrl.listacentroresultados" class="form-control" required>
								    			<option value="">Selecione...</option>
								    		</select>
								    		<span class="red" ng-show="atividade.centro_resultado.$invalid">Centro de resultado é obrigatório.</span>
										</div>
									</div>
									<div class="col-sm-2">
										<div class="form-group form-group-sm">
											<label for="horas_previstas">Horas previstas</label> 
								    		<input type="number" id="horas_previstas" class="form-control" ng-model="$ctrl.atividade.horas_previstas" ng-change="$ctrl.changeatividade()" name="horas_previstas" required/>
								    		<span class="red" ng-show="atividade.horas_previstas.$invalid">Horas previstas é obrigatório.</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
					
					<button type="button" class="btn btn-default margin" ng-click="$ctrl.salvaratividade()" ng-disabled="atividade.$invalid">
				  		Incluir
					</button>
					
					<button type="button" class="btn btn-default margin" ng-click="$ctrl.novaatividade()">
				  		Novo
					</button>
					
				</div>
				<div class="col-sm-3">
					
					<div class="panel panel-primary margin-top">
						<div class="panel-heading">
							<strong>Horas para cada centro de resultado</strong>
						</div>
						<div class="panel-body">
							<div class="row" ng-repeat="centroresultadohora in $ctrl.listacentroresultadoshoras">
								<div class="col-sm-12">
									<label>{{centroresultadohora.fase__itemfase__valor_hora__centro_resultado__nome}}</label>
									<div class="form-group form-group-sm">
										Total horas
										<input type="number" id="total_horas" class="form-control" ng-model="centroresultadohora.total_horas" name="total_horas" disabled/>
									</div>
									<div class="form-group form-group-sm">
										Horas restantes
										<input type="number" id="horas_restantes" ng-model="centroresultadohora.horas_restantes" class="form-control" name="horas_restantes" disabled/>
									</div>
								</div>
							</div>
						</div>
					</div>
					
				</div>
			</div>
			
			<table class="table table-sm table-bordered table-striped table-highlight">
				<thead>
					<tr class="active">
						<th>ID</th>
						<th>Título</th>
						<th>Responsável</th>
						<th></th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="atividade in $ctrl.demanda.atividades" ng-show="!atividade.remover">
						<td class="col-sm-1">
							<input type="text" id="id" name="id" ng-model="atividade.id" maxlength="30" class="form-control" disabled/>
						</td>
						<td class="col-sm-6">
							<input type="text" id="descricao" name="descricao" ng-model="atividade.titulo" maxlength="30" gb-money class="form-control" disabled/>
						</td>
						<td class="col-sm-6">
							<input type="text" id="valor_total" name="valor_total" ng-model="atividade.responsavel.nome" maxlength="30" gb-money class="form-control" disabled/>
						</td>
						<td>
							<button type="button" class="btn btn-default" ng-click="$ctrl.editaratividade(atividade)">
								<span class="glyphicon glyphicon-edit"></span>
							</button>
						</td>
						<td>
							<button type="button" class="btn btn-default" ng-click="$ctrl.remover(atividade, $ctrl.changeatividade)">
								<span class="glyphicon glyphicon-trash"></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
			
		</div>
  		<div id="itens_faturamento" class="tab-pane">
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionaritem()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar item
			</button>
			
			<form name="itensfaturamento" ng-repeat="item_faturamento in $ctrl.demanda.itens_faturamento" ng-show="!item_faturamento.remover">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<strong>{{item_faturamento.descricao ? item_faturamento.descricao : '(Sem descrição)'}}</strong>
						<div class="btn-group pull-right">
							<button type="button" class="btn btn-primary" ng-click="$ctrl.remover(item_faturamento)">
			  					<span class="glyphicon glyphicon-trash margin"></span>
							</button>
						</div>
					</div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group form-group-sm">
									<label for="descricao">Descrição</label> 
								    <input type="text" id="descricao" name="descricao" ng-model="item_faturamento.descricao" class="form-control" required maxlength="200"/>
								    <span class="red" ng-show="itensfaturamento.descricao.$invalid">Descrição é obrigatório.</span>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group form-group-sm">
									<label for="numero_nota">Numero da nota</label> 
								    <input type="text" id="numero_nota" name="numero_nota" ng-model="item_faturamento.numero_nota" class="form-control" required maxlength="30"/>
								    <span class="red" ng-show="itensfaturamento.numero_nota.$invalid">Numero da nota é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="comissao_comercial">Status</label> 
								     <select id="cargo" name="cargo" ng-model="item_faturamento.status" class="form-control">
							    		<option value="">Selecione um tipo...</option>
							    		<option value="P">Pendente aprovação</option>
							    		<option value="A">Aprovado</option>
							    		<option value="R">Reprovado</option>
							    	</select>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_env_aprov">Data envio aprovação</label> 
								    <input type="text" id="data_env_aprov" name="data_env_aprov" ng-model="item_faturamento.data_envio_aprovacao" ui-mask="99/99/9999" model-view-value="true" ng-change="$ctrl.changedataenvioaprovacao(item_faturamento)"  class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_previsto_faturamento">Data previsto faturamento</label>
								    <input type="text" id="data_previsto_faturamento" name="data_previsto_faturamento" ng-model="item_faturamento.data_previsto_faturamento" ui-mask="99/99/9999" model-view-value="true" ng-change="$ctrl.dataprevistofaturamento(item_faturamento)" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_previsto_pagamento">Data previsto pagamento</label> 
								    <input type="text" id="data_previsto_pagamento" name="data_previsto_pagamento" ng-model="item_faturamento.data_previsto_pagamento" ui-mask="99/99/9999" model-view-value="true" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_fat">Data faturamento</label> 
								    <input type="text" id="data_fat" name="data_fat" ng-model="item_faturamento.data_fatura" ui-mask="99/99/9999" model-view-value="true" class="form-control"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group form-group-sm">
									<label for="data_pagamento">Data pagamento</label> 
								    <input type="text" id="data_pagamento" name="data_pagamento" ng-model="item_faturamento.data_pagamento" ui-mask="99/99/9999" model-view-value="true" class="form-control"/>
								</div>
							</div>
						</div>
						
						<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarvalorhora(item_faturamento)">
					  		<span class="glyphicon glyphicon-plus"></span> Adicionar valor hora
						</button>
						
						<table class="table table-sm table-bordered table-striped table-highlight">
							<thead>
								<tr class="active">
									<th>Valor hora</th>
									<th>Valor</th>
									<th>Quantidade de horas</th>
									<th>Valor faturamento</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="valorhora in item_faturamento.valorhoras" ng-show="!valorhora.remover">
									<td>
										<select id="cargo" name="cargo" ng-model="valorhora.valor_hora.id" ng-change="$ctrl.changevalorhoraitem(valorhora, item_faturamento)" class="form-control" ng-options="l.id as l.descricao for l in $ctrl.listavalorhora">
								    		<option value="">Selecione um tipo...</option>
								    	</select>
									</td>
									<td>
										<input type="text" id="comissao_comercial" name="comissao_comercial" ng-model="valorhora.valor" ng-change="$ctrl.changevalorhoraitem(valorhora, item_faturamento)" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<input type="number" id="comissao_comercial" name="comissao_comercial" ng-model="valorhora.quantidade_horas" ng-change="$ctrl.changevalorhoraitem(valorhora, item_faturamento)" class="form-control"/>
									</td>
									<td>
										<input type="text" id="valor_faturamento" name="valor_faturamento" ng-model="valorhora.valor_faturamento" maxlength="30" gb-money class="form-control" disabled/>
									</td>
									<td>
										<button type="button" class="btn btn-default" ng-click="$ctrl.remover(valorhora); $ctrl.recalcularfaturamentototal(item_faturamento);">
											<span class="glyphicon glyphicon-trash"></span>
										</button>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="col-sm-4">
							<div class="form-group form-group-sm">
								<label for="valor_total_faturamento">Valor total da fatura</label> 
							    <input type="text" id="valor_total_faturamento" name="valor_total_faturamento" ng-model="item_faturamento.valor_total_faturamento" gb-money class="form-control" disabled/>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		
		<div id="proposta" class="tab-pane">
		   	
		   	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarproposta()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar proposta
			</button>
			
			<form name="proposta" >
				<table class="table table-sm table-bordered table-striped table-highlight">
					<thead>
					  <tr class="active">
					    <th colspan="4">Proposta</th>
					    <th colspan="3">Aprovação</th>
					    <th></th>
					  </tr>
					  <tr class="active">
					    <th>Data recimento solicitação</th>
					    <th>Data limite entrega</th>
					    <th>Data real entrega</th>
					    <th>Númerdo da proposta B2Card</th>
					    <th>Data de aprovação</th>
					    <th>Empresa ganhadora</th>
					    <th>Tot horas ganhadora</th>
					    <th></th>
					  </tr>
					</thead>
					<tbody>
						<tr ng-repeat="proposta in $ctrl.demanda.propostas" ng-show="!proposta.remover">
							<td>
								<input type="text" ng-model="proposta.data_recimento_solicitacao" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_limite_entrega" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_real_entrega" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.numerdo_proposta" class="form-control" maxlength="30" placeholder="Númerdo da proposta B2Card"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.data_aprovacao" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
							</td>
							<td>
								<input type="text" ng-model="proposta.empresa_ganhadora" class="form-control" maxlength="30" placeholder="Empresa ganhadora"/>
							</td>
							<td>
								<input type="number" ng-model="proposta.total_horas_ganhadora" class="form-control" placeholder="Tot horas ganhadora"/>
							</td>
							<td>
								<button type="button" class="btn btn-default" ng-click="$ctrl.remover(proposta)">
									<span class="glyphicon glyphicon-trash"></span>
								</button>
							</td>
						</tr>
					</tbody>
				</table>
			</form>
		</div>
		
		<div id="tarefas" class="tab-pane">
		
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionartarefa()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar tarefa
			</button>	
			<form name="tarefaform" ng-repeat="tarefa in $ctrl.demanda.tarefas" ng-show="!tarefa.remover">
				<div class="panel panel-primary form-group-sm">
					<div class="panel-heading">
						<div class="btn-group" ng-show="!tarefa.show">
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(tarefa)">
			  					<span class="glyphicon glyphicon-plus margin"></span>
							</button>
						</div>
						<div class="btn-group"  ng-show="tarefa.show">
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(tarefa)">
			  					<span class="glyphicon glyphicon-minus margin"></span>
							</button>
						</div>
						<strong>{{tarefa.descricao ? tarefa.descricao : '(Sem descrição)'}}</strong>
						<div class="btn-group pull-right">					
							<button type="button" class="btn btn-primary" ng-click="$ctrl.remover(tarefa)">
			  					<span class="glyphicon glyphicon-trash margin"></span>
							</button>
						</div>
					</div>
					<div class="panel-body" ng-show="tarefa.show">
						<div class="row">
							<div class="col-sm-5">
								<div class="form-group">
									<label for="descricao">Descrição</label> 
								    <textarea id="descricao" name="descricao" ng-model="tarefa.descricao" class="form-control" required></textarea>
								    <span class="red" ng-show="tarefaform.descricao.$invalid">Descrição é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-3">
								<div class="form-group">
									<label for="analista_tecnico_responsavel">Analista técnico responsável</label> 
								    <select id=analista_tecnico_responsavel name="analista_tecnico_responsavel" class="form-control" ng-model="tarefa.analista_tecnico_responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um analista...</option>
									</select>
								    <span class="red" ng-show="tarefaform.analista_tecnico_responsavel.$invalid">Analista técnico responsável é obrigatório.</span>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="descricao">Responsável</label> 
								    <select id=responsavel name="responsavel" class="form-control" ng-model="tarefa.responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um analista...</option>
									</select>
								    <span class="red" ng-show="tarefaform.responsavel.$invalid">Responsável é obrigatório.</span>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Análise</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Inicio</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.analise_inicio" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim">Fim</label> 
												    <input type="text" id="analise_fim" name="analise_fim" ng-model="tarefa.analise_fim" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim_real">Fim Real</label> 
												    <input type="text" id="analise_fim_real" name="analise_fim_real" ng-model="tarefa.analise_fim_real" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Desenvolvimento</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Inicio</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.densenvolvimento_inicio" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim">Fim</label> 
												    <input type="text" id="analise_fim" name="analise_fim" ng-model="tarefa.desenvolvimento_fim" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="analise_fim_real">Fim Real</label> 
												    <input type="text" id="analise_fim_real" name="analise_fim_real" ng-model="tarefa.desenvolvimento_fim_real" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Homologação</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_possui_sit">Possui SIT</label> 
												    <select id="homologacao_possui_sit" ng-model="tarefa.homologacao_possui_sit" class="form-control">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_inicio">Inicio</label> 
												    <input type="text" id="homologacao_inicio" name="homologacao_inicio" ng-model="tarefa.homologacao_inicio" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_fim">Fim</label> 
												    <input type="text" id="homologacao_fim" name="homologacao_fim" ng-model="tarefa.homologacao_fim" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="homologacao_fim_real">Fim Real</label> 
												    <input type="text" id="homologacao_fim_real" name="homologacao_fim_real" ng-model="tarefa.homologacao_fim_real" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="panel panel-info form-group-sm">
									<div class="panel-heading heading-text-align"><strong>Entrega da Demanda</strong></div>
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Forecast</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.forecast" class="form-control" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Aceite</label> 
													<select class="form-control" ng-model="tarefa.aceite">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>																		
												</div>
											</div>
											<div class="col-sm-3">
												<div class="form-group">
													<label for="identificacao">Evidências</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.evidencias" class="form-control" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Implantação em produção</label> 
												    <input type="text" id="analise_inicio" name="analise_inicio" ng-model="tarefa.implantacao_producao" class="form-control" ui-mask="99/99/9999" model-view-value="true" maxlength="12"/>											
												</div>
											</div>
											<div class="col-sm-4">
												<div class="form-group">
													<label for="identificacao">Implantação in logo?</label> 
												    											
													<select class="form-control" ng-model="tarefa.implantacao_in_loco">
												    	<option value="">Selecione...</option>
												    	<option value="S">Sim</option>
												    	<option value="N">Não</option>
												    </select>																		
												
												</div>											
											</div>
											
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	
		<div id="observacoes" class="tab-pane">
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarobservacao()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar observação
			</button>
			
			<table class="table table-sm table-bordered table-striped table-highlight">
				<thead>
				  <tr class="active">
				    <th class="col-sm-2">Data da observação</th>
				    <th class="col-sm-12">Observação</th>
				    <th></th>
				  </tr>
				</thead>
				<tbody>
					<tr ng-repeat="observacao in $ctrl.demanda.observacoes" ng-show="!observacao.remover">
						<td class="col-sm-2">
							<input type="text" ng-model="observacao.data_observacao" class="form-control" ui-mask="99/99/9999" model-view-value="true"/>
						</td>
						<td class="col-sm-12">
							<textarea ng-model="observacao.observacao" class="form-control" placeholder="Observação"></textarea>
						</td>
						<td>
							<button type="button" class="btn btn-default" ng-click="$ctrl.remover(observacao)">
								<span class="glyphicon glyphicon-trash"></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="ocorrencias" class="tab-pane">
		
			<button type="button" class="btn btn-primary margin" ng-click="$ctrl.adicionarocorrencia()">
		  		<span class="glyphicon glyphicon-plus"></span> Adicionar ocorrência
			</button>
			
			<form name="ocorrenciasform" ng-repeat="ocorrencia in $ctrl.demanda.ocorrencias" ng-show="!ocorrencia.remover">
				<div class="panel panel-primary form-group-sm">
					<div class="panel-heading">
						<div class="btn-group" ng-show="!ocorrencia.show">					
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(ocorrencia)" >
			  					<span class="glyphicon glyphicon-plus margin"></span>
							</button>
						</div>
						<div class="btn-group" ng-show="ocorrencia.show">
							<button type="button" class="btn btn-primary dropdown-toggle" ng-click="$ctrl.layout(ocorrencia)" >
			  					<span class="glyphicon glyphicon-minus margin"></span>
							</button>
						</div>
						<strong>{{ocorrencia.descricao ? ocorrencia.descricao : '(Sem descrição)'}}</strong>
						<div class="btn-group pull-right">					
							<button type="button" class="btn btn-primary" ng-click="$ctrl.remover(ocorrencia)">
			  					<span class="glyphicon glyphicon-trash margin"></span>
							</button>
						</div>
					</div>
					<div class="panel-body" ng-show="ocorrencia.show">
						<div class="row">
							<div class="col-sm-3">
								<div class="form-group">
									<label for="tipo_ocorrencia">Tipo de ocorrência</label> 
								    <select class="form-control" id="tipo_ocorrencia" name="tipo_ocorrencia" ng-model="ocorrencia.tipo_ocorrencia" required>
								    	<option value="">Selecione...</option>
								    	<option value="E">Erro</option>
								    	<option value="S">Erro de Especificação</option>
								    	<option value="F">Fora do escopo inicial do projeto</option>
									</select>
									<span class="red" ng-show="ocorrenciasform.tipo_ocorrencia.$invalid">Tipo de ocorrência é obrigatório.</span>											
								</div>
							</div>
							<div class="col-sm-7">
								<div class="form-group">
									<label for="descricao">Descricao</label> 
								    <input type="text" class="form-control" id="descricao" name="descricao" ng-model="ocorrencia.descricao" maxlength="100"/>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-3">
								<div class="form-group">
									<label for="nome_solicitante">Nome do solicitante</label> 
								    <input type="text" class="form-control" id="nome_solicitante" name="nome_solicitante" ng-model="ocorrencia.nome_solicitante" maxlength="30"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="data_solicitacao">Data de solicitação</label> 
								    <input type="text" class="form-control" id="data_solicitacao" name="data_solicitacao" ng-model="ocorrencia.data_solicitacao" ui-mask="99/99/9999" model-view-value="true"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="data_prevista_conclusao">Data prevista conclusão</label> 
								    <input type="text" class="form-control" id="data_prevista_conclusao" name="data_prevista_conclusao" ng-model="ocorrencia.data_prevista_conclusao" ui-mask="99/99/9999" model-view-value="true"/>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="etapa">Etapa</label> 
								    <select class="form-control" id="etapa" name="etapa" ng-model="ocorrencia.etapa">
								    	<option value="">Selecione...</option>
								    	<option value="C">Concluído</option>
								    	<option value="A">Aguardando análise</option>
								    	<option value="E">Em avaliação</option>
									</select>											
								</div>
							</div>
							<div class="col-sm-2">
								<div class="form-group">
									<label for="responsavel">Responsável B2Card</label> 
								    <select id=responsavel name="responsavel" class="form-control" ng-model="ocorrencia.responsavel.id" ng-options="f.id as f.nome for f in $ctrl.listafuncionarios" required>
									   	<option value="">Selecione um responsável...</option>
									</select>
								</div>
							</div>
							</div>
							<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<label for="descricao_motivo">Descrição do motivo que causaram a ocorrência</label> 
								    <textarea class="form-control" id="descricao_motivo" name="descricao_motivo" ng-model="ocorrencia.descricao_motivo"></textarea>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label for="observacao">Observação</label> 
								    <textarea class="form-control" id="observacao" name="observacao" ng-model="ocorrencia.observacao"></textarea>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		<div id="contasreceber" class="tab-pane" ng-show="$ctrl.demanda.parcelas && $ctrl.demanda.parcelas.length > 0">

			<div class="panel panel-primary form-group-sm">
				<div class="panel-body">
					<div class="row">
						<div class="col-sm-4">
							<div class="form-group">
								<label for="total_orcamento">Total orcamento</label>
								<input type="text" id="total_orcamento" name="total_orcamento" ng-model="$ctrl.demanda.orcamento.total_orcamento" class="form-control" disabled/>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="form-group">
								<label for="total_orcamento">Valor restante</label>
								<input type="text" id="total_orcamento" name="total_orcamento" ng-model="$ctrl.parcela.valor_restante" class="form-control" disabled/>
							</div>
						</div>
					</div>
				</div>
			</div>

			<button type="button" class="btn btn-default margin" ng-click="$ctrl.adicionarparcela()">Adicionar parcela</button>
			
			<table class="table table-sm table-bordered table-striped table-highlight" ng-show="$ctrl.demanda.tipo_parcela == 'P'">
				<thead>
					<tr class="active">
						<th>ID</th>
						<th>Descrição</th>
						<th>Data previsto parcela</th>
						<th>Valor da parcela</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="parcela in $ctrl.demanda.parcelas" ng-show="!parcela.remover">
						<td class="col-sm-1">
							<input type="text" id="id" ng-model="parcela.id" name="id" maxlength="30" class="form-control" disabled/>
						</td>
						<td class="col-sm-4">
							<input type="text" id="descricao" ng-model="parcela.descricao" name="descricao" maxlength="30" class="form-control"/>
						</td>
						<td class="col-sm-4">
							<input type="text" id="data_previsto_parcela" ng-model="parcela.data_previsto_parcela" name="data_previsto_parcela" maxlength="30" ui-mask="99/99/9999" model-view-value="true" class="form-control"/>
						</td>
						<td class="col-sm-4">
							<input type="text" id="valor_parcela" ng-model="parcela.valor_parcela" name="valor_parcela" ng-change="$ctrl.calcularvalorrestante(); $ctrl.calcularnumerohorasparcelas();" maxlength="30" gb-money class="form-control"/>
						</td>
						<td>
							<button type="button" class="btn btn-default" ng-click="$ctrl.remover(parcela, $ctrl.calcularvalorrestante)">
								<span class="glyphicon glyphicon-trash"></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
			
			<table class="table table-sm table-bordered table-striped table-highlight margin-top"  ng-show="$ctrl.demanda.tipo_parcela == 'M'">
				<thead>
					<tr class="active">
						<th>Descrição</th>
						<th>Data prevista parcela</th>
						<th>Medições</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="parcela in $ctrl.demanda.parcelas" ng-show="!parcela.remover">
						<td>
							<input type="text" id="descricao" ng-model="parcela.descricao" name="descricao" maxlength="30" class="form-control" ng-required="$ctrl.demanda.tipo_parcela == 'M'"/>
						</td>
						<td>
							<input type="text" id="data_prevista" ng-model="parcela.data_previsto_parcela" name="data_prevista" maxlength="30" ui-mask="99/99/9999" model-view-value="true"  class="form-control" ng-required="$ctrl.demanda.tipo_parcela == 'M'"/>
						</td>
						<td>
							<button type="button" class="btn btn-default" ng-click="$ctrl.adicionarmedicao(parcela)">
								Adicionar
							</button>
							<table class="table table-sm table-bordered">
								<thead>
									<tr>
										<th class="col-sm-3">Tipo hora</th>
										<th class="col-sm-2">Valor hora</th>
										<th class="col-sm-2">Quantidade</th>
										<th>Valor</th>
										<th class="col-sm-1"></th>
									</tr>
								</thead>
								<tbody>
									<tr ng-repeat="medicao in parcela.medicoes" ng-show="!medicao.remover">
										<td>
											<select id="valorhora" name="valorhora" ng-model="medicao.valor_hora.id" class="form-control" ng-change="$ctrl.changevalorhoraparcela(medicao); $ctrl.changequantidadehorasparcela(medicao);" ng-options="v.id as v.descricao for v in $ctrl.listavalorhora" ng-required="$ctrl.demanda.tipo_parcela == 'M'">
									    		<option value="">Selecione um tipo...</option>
									    	</select>
										</td>
										<td>
											<input type="text" id="valor" ng-model="medicao.valor" name="valor" class="form-control" value="2,00" disabled/>
										</td>
										<td>
											<input type="number" id="quantidade_horas" ng-model="medicao.quantidade_horas" ng-change="$ctrl.changequantidadehorasparcela(medicao)" name="quantidade_horas" class="form-control" ng-required="$ctrl.demanda.tipo_parcela == 'M'"/>
										</td>
										<td>
											<input type="text" id="valor_total" name="valor_total" ng-model="medicao.valor_total" class="form-control" value="30,00" disabled/>
										</td>
										<td>
											<button type="button" class="btn btn-default" ng-click="$ctrl.remover(medicao, $ctrl.calcularvalortotalparcelas)">
												<span class="glyphicon glyphicon-trash"></span>
											</button>
										</td>
									</tr>
								</tbody>
							</table>
							
							<div class="form-group form-group-sm col-sm-5">
								<label for="descricao">Valor total</label> 
							    <input type="text" id="descricao" name="descricao" ng-model="parcela.valor_parcela" class="form-control" disabled ng-required="$ctrl.demanda.tipo_parcela == 'M'"/>
							</div>
							
						</td>
						<td>
							<button type="button" class="btn btn-default" ng-click="$ctrl.remover(parcela, $ctrl.calcularvalorrestante)">
								<span class="glyphicon glyphicon-trash"></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	
	
	<button type="button" class="btn btn-primary margin" ng-click="$ctrl.salvardemanda()" ng-disabled="demanda.$invalid || itensfaturamento.$invalid">Salvar</button>
	<button type="submit" class="btn btn-danger margin" name="deletar" ng-click="$ctrl.deletar()" ng-show="$ctrl.demanda.id">Deletar</button>
	<div class="label {{$ctrl.clazz}}" ng-bind="$ctrl.message" ></div>
	
</div>

{%endverbatim%}

{%endblock%}