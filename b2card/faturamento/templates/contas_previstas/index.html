<meta charset="utf-8">
{% extends "base_page.html" %}

{% block script %}
	<script src="/static/js/apps/faturamento/contasreceber/contasreceber.js"></script>
	<script src="/static/js/apps/faturamento/contasreceber/contasreceber-service.js"></script>
	<script src="/static/js/apps/cadastros/pessoa/pessoa-services.js"></script>
	<script src="/static/js/apps/demandas/demandas-services.js"></script>
	<script src="/static/js/apps/faturamento/parcela.js"></script>
	<script src="/static/js/apps/faturamento/parcela-services.js"></script>
	<script src="/static/js/apps/cadastros/valorhora/valorhora-services.js"></script>
	<script src="/static/js/commons/commons.js"></script>
	<script src="/static/js/angular/ui-bootstrap-tpls-2.2.0.min.js"></script>
	<script src="/static/js/jquery/priceformat/jquery.priceformat.min.js"></script>
{% endblock %}



{%block content%}

<style>

button.margin {
	margin-top: 21px
}

.app-modal-window .modal-dialog {
	  width: 100%;
	  height: 100%;
	  margin: 0;
	  padding: 0;
	}
	.modal-content {
	  height: auto;
	  min-height: 100%;
	  border-radius: 0;
	}

</style>

{%verbatim%}

<div ng-app="contasreceber" class="ng-hide" ng-show="$ctrl.show" ng-controller="ContasReceberController as $ctrl">

	<div class="alert alert-danger" ng-show="$ctrl.messagem">
		 {{$ctrl.messagem}}
	</div>
	
	<div class="panel panel-primary form-group-sm">
		<div class="panel-body">
			<form name="arguments">
				<div class="form-group">
					<label for="cliente">Cliente</label>
					<select type="text" id="cliente" name="cliente" ng-model="$ctrl.arguments.cliente_id" class="form-control" ng-options="c.id as c.pessoa.nome_razao_social for c in $ctrl.listaclientes">
						<option value="">Selecione...</option>
					</select>
				</div>
				<button type="button" class="btn btn-sm btn-default margin" ng-click="$ctrl.pesquisar();">Pesquisar</button>
			</form>
		</div>
	</div>
	
	<div class="col-sm-4">
	<table class="table table-sm">
		<thead>
			<tr>
				<th>Cliente</th>
				<th>Demanda</th>
				<th>Data</th>
				<th></th>
				<th>Total</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="contareceber in $ctrl.resultados" ng-click="$ctrl.abrircontasreceber(contareceber);">
				<td>
					{{contareceber.demanda.cliente.razao_social}}
				</td>
				<td>
					{{contareceber.demanda.nome_demanda}}
				</td>
				<td>
					{{contareceber.data_previsto_parcela}}
				</td>
				<td>
					<table class="table table-sm">	
						<thead>
							<tr>
								<th>
									Fase
								</th>
								<th>
									Valor
								</th>
							</tr>					
						<tbody>
							<tr ng-repeat="parcelafase in contareceber.parcelafases">
								<td>
									{{parcelafase.fase.descricao}}
								</td>
								<td>
									{{parcelafase.valor}}
								</td>
							</tr>
						</tbody>
					</table>
				</td>
				<td>
					{{contareceber.valor_parcela}}
				</td>
			</tr>
		</tbody>
	</table>
	</div>
	<div class="col-sm-8">
		<table class="table table-sm">
			<thead>
				<tr>
					<th></th>
					<th>Cliente</th>
					<th>Parcela</th>
					<th>Dt.Prev.Fat</th>
					<th>Fase</th>
					<th>Perfil</th>
					<th>Horas</th>
					<th>Valor</th>
					<th>Valor total</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="itemfaturamento in $ctrl.listaitensfaturamento">
					<td>
						<div class="glyphicon glyphicon-remove" style="cursor: pointer;" ng-click="$ctrl.removeritemfaturamento();"></div>
					</td>
					<td>
						{{itemfaturamento.demanda.cliente.pessoa.nome_razao_social}}
					</td>
					<td>
						{{itemfaturamento.descricao}}
					</td>
					<td>
						{{itemfaturamento.data_previsto_parcela}}
					</td>
					<td>
						<div ng-repeat="parcelafase in itemfaturamento.parcelafases">
							<select ng-model="parcelafase.fase.id" ng-options="f.id as f.fase.descricao for f in $ctrl.listafases" ng-change="$ctrl.verificarduplicidadefase(parcela, parcelafase, {{ parcelafase.fase && parcelafase.fase.id ? parcelafase.fase.id : 'null' }})" class="form-control">
						    	<option value="">Selecione...</option>
						    </select>
					    	<div ng-repeat="n in [].constructor(parcelafase.medicoes.length - 1)" style="height: 26px;">&nbsp;</div>
						</div>
					</td>
					<td>
						<span ng-repeat="parcelafase in itemfaturamento.parcelafases">
							<span ng-repeat="medicao in parcelafase.medicoes">
								<select id="valorhora" name="valorhora" ng-model="medicao.valor_hora.id" class="form-control" ng-change="$ctrl.verificarduplicidade(parcelafase, medicao, {{ medicao.valor_hora && medicao.valor_hora.id ? medicao.valor_hora.id : 'null' }}); $ctrl.changevalorhora(medicao); $ctrl.changequantidadehoras(medicao);" ng-options="v.id as v.descricao for v in $ctrl.valorhoraobject[parcelafase.fase.id]">
						    		<option value="">Selecione um tipo...</option>
						    	</select>
							</span>
						</span>	
					</td>
					<td>
						<span ng-repeat="parcelafase in itemfaturamento.parcelafases">
							<span ng-repeat="medicao in parcelafase.medicoes">
								<input type="text" id="quantidade_horas" ng-model="medicao.quantidade_horas" ng-change="$ctrl.changequantidadehoras(medicao)" gb-number name="quantidade_horas" class="form-control"/>
							</span>
						</span>
					</td>
					<td>
						<span ng-repeat="parcelafase in itemfaturamento.parcelafases">
							<span ng-repeat="medicao in parcelafase.medicoes">
								<input type="text" id="valor_total" name="valor_total" ng-model="medicao.valor_total" ng-change="$ctrl.calcularhorasmedicoes()" gb-money class="form-control"/>
							</span>
						</span>
					</td>
					<td>
						<input type="text" id="valor_parcela" name="valor_parcela" ng-model="itemfaturamento.valor_parcela" class="form-control" disabled/>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

{%endverbatim%}

{%endblock%}